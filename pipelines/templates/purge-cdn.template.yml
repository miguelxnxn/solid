steps:
  - task: AzureCLI@2
    displayName: 'Purge CDN from step above'
    inputs:
      azureSubscription: 'Workload CI/CD Service Connection (S_STATICCONTENT_PROD)'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        if [[ $(deployment) != "none" ]]; then
          ## create an array of folder paths to purge
          folderPaths=($(branch) $(version) $(patchWildcardPath) $(majorWildcardPath) $(minorWildcardPath))
          ## loop through the array and purge each folder path
          for folderPath in "${folderPaths[@]}"; do
            if [[ -z $folderPath ]]; then
              echo "Folder path is empty, therefore nothing to purge."
            else
              echo "Purging folder path '$folderPath'..."
              set -x
              az cdn endpoint purge \
                --resource-group rg-staticcontent-prod-frontend-cdn \
                --profile-name cdn-staticcontent-prod-frontend-cdn \
                --name "fe-solid-design-system-prod" \
                --content-paths "/$folderPath/*" \
                --no-wait
              set +x
            fi
          done
        else
          echo "Deployment type is 'none', therefore nothing to purge."
        fi
